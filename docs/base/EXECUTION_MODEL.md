# EXECUTION_MODEL.md — Executor 클래스 명세

## 0. 이 문서의 지위

이 문서는 **BASE_ARCHITECTURE.md의 하위 문서**다.

> **BASE_ARCHITECTURE.md가 "Executor는 주문 실행"이라 했으므로,
> 이 문서는 그 실행 방식만 정의한다.**

구조 결정 권한: BASE_ARCHITECTURE.md
실행 방식 정의 권한: 이 문서

**클래스 매핑**: Executor

이 문서는 전략 문서가 아니다.
리스크 문서도 아니다.

> **이 문서는
> '좋은 판단이 실제 수익으로 변환될 수 있는지'를
> 결정하는 마지막 관문이다.**

Account Builder 시스템에서
Execution 실패 = 즉시 계좌 사망 가능성 증가다.

---

## 1. Execution의 기본 철학

### 절대 원칙 3가지

1. **청산가를 악화시키는 체결은 금지**
2. **예상하지 않은 비용(슬리피지)은 리스크**
3. **실행 실패는 전략 실패보다 더 치명적**

> 작은 계좌일수록  
> “조금 더 불리한 체결”이  
> 전체 시스템을 무너뜨릴 수 있다.

---

## 2. 주문 방식 원칙

### 2.1 기본 주문 타입

- 기본: **Limit Order (Maker)**
- 예외적 상황에서만 Market Order 허용

이유:
- 수수료 절감
- 진입 가격 통제
- 청산가 안정성 확보

---

### 2.2 Market Order 사용 조건 (엄격)

다음 조건이 동시에 충족될 때만 허용:

- 급격한 추세 붕괴 감지
- 미체결 시 손실이 급격히 확대되는 상황
- 청산 위험이 Market Slippage보다 클 때

> Market Order는  
> “편해서” 쓰는 게 아니라  
> **“덜 나쁜 선택”일 때만 쓴다.**

---

## 3. 진입 실행 로직

### 3.1 초기 진입 (ENTRY 상태)

- 항상 **분할 진입**
- 단일 주문으로 전량 진입 금지
- 진입 후 즉시:
  - 청산가 확인
  - 증거금 여유 재계산

목적:
> **틀렸을 때 빠져나올 공간 확보**

---

### 3.2 공격 진입 (EXPANSION 상태)

이 상태는 예외적이다.

허용되는 특징:
- 주문 사이즈 증가
- 체결 속도 우선
- 일부 Taker 허용

단,
- 청산가가 급격히 가까워지면 즉시 중단
- 추가 확장은 “수익 구간”에서만 허용

---

## 4. 미체결 주문 관리 (Critical)

### 4.1 미체결 주문의 위험성

미체결 주문은:
- 허위 노출(False Exposure)
- 리스크 계산 오류
- 의도하지 않은 중복 포지션

으로 이어질 수 있다.

---

### 4.2 미체결 관리 규칙

- 일정 시간 미체결 시:
  - 주문 취소
  - 가격 재조정 후 재주문
- 무한 Chase 금지
- Chase 횟수 제한 명시

---

## 5. 청산 및 종료 실행

### 5.1 성공적 종료 (EXIT_SUCCESS)

- 분할 청산 허용 ❌
- 목표 도달 시 **전량 청산**
- 잔여 포지션 방치 금지

이유:
> Account Builder의 성공은  
> “한 번의 점프”이지  
> “조금씩 챙기기”가 아니다.

---

### 5.2 실패 종료 (EXIT_FAILURE)

- 손실 확정은 **즉시**
- 미련 금지
- 반대 포지션 전환 금지

> 틀렸다는 판단을  
> Execution 단계에서  
> 뒤집지 마라.

---

## 6. 슬리피지 및 비용 통제

### 6.1 슬리피지 관리

- 허용 슬리피지 임계치 정의
- 임계치 초과 시:
  - 신규 진입 차단
  - 상태를 COOLDOWN으로 전환

---

### 6.2 수수료 인식

- 작은 계좌에서는 수수료가 전략을 잠식한다
- Execution은 항상:
  - “이 트레이드의 기대값이  
    비용을 이기고 있는가?”를 질문해야 한다

---

## 7. 실행 로그 (Non-Negotiable)

모든 주문은 반드시 기록한다:

- 주문 타입
- 의도된 가격
- 실제 체결 가격
- 슬리피지
- 체결 지연

> 이 로그 없이는  
> 전략 개선도, 실패 분석도 불가능하다.

---

## 8. 이 Execution Model의 결론

> **Account Builder에서 Execution은  
> 공격을 가능하게 만드는 ‘안전장치’다.**

- 공격적 전략 ⭕
- 공격적 실행 ❌

> **판단은 과감하게,  
> 실행은 냉정하게.**

---

## 9. 이 문서를 읽는 개발자에게

이 문서를 "보수적"이라고 느낀다면,
Account Builder를 오해한 것이다.

> **이 Execution Model은
> 작은 계좌가
> 공격할 수 있도록
> 만들어진 구조다.**

---

## 10. BASE_ARCHITECTURE.md와의 관계

이 문서는:
- **구조를 결정하지 않는다** (BASE가 결정)
- **실행 방식만 정의한다**
- Executor 클래스의 명세서

BASE_ARCHITECTURE.md가 "Executor는 Position Plan을 받아 실행"이라 했으므로,
이 문서는 그 Plan을 "어떻게 주문으로 바꾸는지" 정의한다.

**역할 분리 명확.**
