============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-7.4.3, pluggy-1.6.0 -- /home/selios/dg_bybit/venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/selios/dg_bybit
configfile: pyproject.toml
testpaths: tests
plugins: cov-4.1.0
collecting ... collected 335 items / 15 deselected / 320 selected

tests/integration/test_dry_run_orchestrator.py::TestDryRunMonitor::test_dry_run_monitor_initialization PASSED [  0%]
tests/integration/test_dry_run_orchestrator.py::TestDryRunMonitor::test_cycle_complete_logging PASSED [  0%]
tests/integration/test_dry_run_orchestrator.py::TestDryRunMonitor::test_halt_detection_session_risk PASSED [  0%]
tests/integration/test_dry_run_orchestrator.py::TestDryRunMonitor::test_halt_detection_emergency PASSED [  1%]
tests/integration/test_dry_run_orchestrator.py::TestDryRunMonitor::test_stop_loss_hit_logging PASSED [  1%]
tests/integration/test_dry_run_orchestrator.py::TestDryRunOrchestration::test_state_transition_detection PASSED [  1%]
tests/integration/test_dry_run_orchestrator.py::TestDryRunOrchestration::test_trade_log_completeness_verification PASSED [  2%]
tests/integration/test_dry_run_orchestrator.py::TestDryRunOrchestration::test_dry_run_with_multiple_cycles PASSED [  2%]
tests/integration/test_orchestrator.py::test_orchestrator_tick_order_emergency_first PASSED [  2%]
tests/integration/test_orchestrator.py::test_orchestrator_full_cycle_flat_to_in_position_to_flat PASSED [  3%]
tests/integration/test_orchestrator.py::test_orchestrator_halt_on_emergency PASSED [  3%]
tests/integration/test_orchestrator.py::test_orchestrator_degraded_mode_blocks_entry PASSED [  3%]
tests/integration/test_orchestrator.py::test_orchestrator_degraded_timeout_triggers_halt PASSED [  4%]
tests/integration/test_orchestrator_session_risk.py::test_daily_loss_cap_triggers_halt PASSED [  4%]
tests/integration/test_orchestrator_session_risk.py::test_weekly_loss_cap_triggers_cooldown PASSED [  4%]
tests/integration/test_orchestrator_session_risk.py::test_loss_streak_3_triggers_halt PASSED [  5%]
tests/integration/test_orchestrator_session_risk.py::test_fee_anomaly_triggers_halt PASSED [  5%]
tests/integration/test_orchestrator_session_risk.py::test_slippage_anomaly_triggers_halt PASSED [  5%]
tests/integration_real/test_full_cycle_testnet.py::test_full_cycle_success PASSED [  5%]
tests/integration_real/test_full_cycle_testnet.py::test_full_cycle_entry_blocked PASSED [  6%]
tests/integration_real/test_full_cycle_testnet.py::test_full_cycle_stop_hit PASSED [  6%]
tests/integration_real/test_full_cycle_testnet.py::test_full_cycle_session_risk_halt PASSED [  6%]
tests/integration_real/test_full_cycle_testnet.py::test_full_cycle_degraded_mode PASSED [  7%]
tests/integration_real/test_full_cycle_testnet.py::test_multiple_cycles_success PASSED [  7%]
tests/oracles/test_flow_v1_9_scenarios.py::TestFlowV19Scenarios::test_event_dedup_ignores_duplicate PASSED [  7%]
tests/oracles/test_flow_v1_9_scenarios.py::TestFlowV19Scenarios::test_event_ordering_ignores_out_of_order PASSED [  8%]
tests/oracles/test_flow_v1_9_scenarios.py::TestFlowV19Scenarios::test_stop_recovery_3_failures_halt PASSED [  8%]
tests/oracles/test_integration_basic.py::TestBasicIntegration::test_fake_exchange_place_order PASSED [  8%]
tests/oracles/test_integration_basic.py::TestBasicIntegration::test_fake_exchange_duplicate_order_link_id PASSED [  9%]
tests/oracles/test_integration_basic.py::TestBasicIntegration::test_fake_exchange_scenario_fill PASSED [  9%]
tests/oracles/test_integration_basic.py::TestBasicIntegration::test_fake_exchange_scenario_partial_fill PASSED [  9%]
tests/oracles/test_integration_basic.py::TestBasicIntegration::test_event_router_entry_pending_to_in_position_on_fill PASSED [ 10%]
tests/oracles/test_integration_basic.py::TestBasicIntegration::test_event_router_entry_pending_to_in_position_on_partial_fill PASSED [ 10%]
tests/oracles/test_integration_basic.py::TestBasicIntegration::test_event_router_entry_pending_to_flat_on_reject PASSED [ 10%]
tests/oracles/test_integration_basic.py::TestBasicIntegration::test_event_router_entry_pending_to_flat_on_cancel_zero_fill PASSED [ 10%]
tests/oracles/test_integration_basic.py::TestBasicIntegration::test_event_router_entry_pending_to_in_position_on_cancel_partial_fill PASSED [ 11%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_entry_pending_to_in_position_on_fill PASSED [ 11%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_entry_pending_to_flat_on_reject PASSED [ 11%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_entry_pending_to_flat_on_cancel_zero_fill PASSED [ 12%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_entry_pending_to_in_position_on_cancel_partial_fill PASSED [ 12%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_entry_pending_to_in_position_on_partial_fill PASSED [ 12%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_exit_pending_to_flat_on_fill PASSED [ 13%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_halt_gate_adl_event PASSED [ 13%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_cooldown_gate_blocks_entry_before_timeout PASSED [ 13%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_cooldown_gate_allows_entry_after_timeout PASSED [ 14%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_one_way_mode_gate_rejects_opposite_direction PASSED [ 14%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_exit_pending_stays_on_reject PASSED [ 14%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracle::test_exit_pending_stays_on_cancel PASSED [ 15%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_flat_unexpected_fill_should_halt PASSED [ 15%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_in_position_additional_partial_fill_increases_qty PASSED [ 15%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_in_position_fill_completes_entry_working_false PASSED [ 15%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_in_position_liquidation_should_halt PASSED [ 16%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_in_position_adl_reduces_qty_and_stays_in_position PASSED [ 16%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_in_position_adl_qty_zero_goes_flat PASSED [ 16%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_in_position_missing_stop_emits_place_stop_intent PASSED [ 17%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_in_position_invalid_filled_qty_halts PASSED [ 17%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_exit_pending_liquidation_should_halt PASSED [ 17%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_exit_pending_partial_fill_reduces_position_qty_and_stays_exit_pending PASSED [ 18%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_exit_pending_fill_should_flat_even_if_position_was_partial_before PASSED [ 18%]
tests/oracles/test_state_transition_oracle.py::TestStateTransitionOracleAdditional::test_exit_pending_overfill_should_halt PASSED [ 18%]
tests/oracles/test_state_transition_oracle.py::TestPartialFillOracle::test_pf1_first_partial_fill_places_stop_immediately PASSED [ 19%]
tests/oracles/test_state_transition_oracle.py::TestPartialFillOracle::test_entry_pending_with_none_pending_order_halts PASSED [ 19%]
tests/unit/test_atr_calculator.py::TestATRCalculator::test_calculate_atr_14_period PASSED [ 19%]
tests/unit/test_atr_calculator.py::TestATRCalculator::test_calculate_atr_insufficient_data PASSED [ 20%]
tests/unit/test_atr_calculator.py::TestATRCalculator::test_calculate_atr_percentile PASSED [ 20%]
tests/unit/test_atr_calculator.py::TestATRCalculator::test_calculate_atr_percentile_min PASSED [ 20%]
tests/unit/test_atr_calculator.py::TestATRCalculator::test_calculate_atr_percentile_max PASSED [ 20%]
tests/unit/test_atr_calculator.py::TestATRCalculator::test_calculate_grid_spacing PASSED [ 21%]
tests/unit/test_atr_calculator.py::TestATRCalculator::test_calculate_grid_spacing_default_multiplier PASSED [ 21%]
tests/unit/test_atr_calculator.py::TestATRCalculator::test_calculate_true_range PASSED [ 21%]
tests/unit/test_atr_calculator.py::TestATRCalculator::test_calculate_true_range_no_gap PASSED [ 22%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterRestIntegration::test_get_mark_price_from_rest_tickers PASSED [ 22%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterRestIntegration::test_get_equity_usdt_from_wallet_balance PASSED [ 22%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterRestIntegration::test_get_index_price_and_funding_rate PASSED [ 23%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterRestIntegration::test_get_current_position_from_rest PASSED [ 23%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterWebSocketIntegration::test_fill_event_conversion_from_ws PASSED [ 23%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterWebSocketIntegration::test_partial_fill_event_conversion PASSED [ 24%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterStateCaching::test_caching_mark_price_between_updates PASSED [ 24%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterStateCaching::test_last_fill_price_tracking PASSED [ 24%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterStateCaching::test_trades_today_counter_increment PASSED [ 25%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterDegradedMode::test_degraded_mode_on_ws_heartbeat_timeout PASSED [ 25%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterDegradedMode::test_degraded_timeout_after_60_seconds PASSED [ 25%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterDegradedMode::test_degraded_exit_clears_timeout PASSED [ 25%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterSessionRiskTracking::test_get_daily_realized_pnl_from_trade_history PASSED [ 26%]
tests/unit/test_bybit_adapter.py::TestBybitAdapterSessionRiskTracking::test_loss_streak_calculation PASSED [ 26%]
tests/unit/test_bybit_rest_client.py::test_generate_signature_is_deterministic PASSED [ 26%]
tests/unit/test_bybit_rest_client.py::test_place_order_payload_satisfies_bybit_spec PASSED [ 27%]
tests/unit/test_bybit_rest_client.py::test_order_link_id_max_length_36_chars PASSED [ 27%]
tests/unit/test_bybit_rest_client.py::test_rate_limit_headers_parsed_correctly PASSED [ 27%]
tests/unit/test_bybit_rest_client.py::test_retcode_10006_triggers_backoff PASSED [ 28%]
tests/unit/test_bybit_rest_client.py::test_timeout_triggers_retry PASSED [ 28%]
tests/unit/test_bybit_rest_client.py::test_testnet_base_url_enforced PASSED [ 28%]
tests/unit/test_bybit_rest_client.py::test_missing_api_key_prevents_process_start PASSED [ 29%]
tests/unit/test_bybit_rest_client.py::test_clock_injection_for_deterministic_timestamp PASSED [ 29%]
tests/unit/test_bybit_rest_client.py::test_cancel_order_payload_satisfies_bybit_spec PASSED [ 29%]
tests/unit/test_bybit_ws_client.py::test_subscribe_topic_correctness_inverse PASSED [ 30%]
tests/unit/test_bybit_ws_client.py::test_disconnect_triggers_degraded_flag PASSED [ 30%]
tests/unit/test_bybit_ws_client.py::test_reconnect_clears_degraded_flag PASSED [ 30%]
tests/unit/test_bybit_ws_client.py::test_ping_pong_timeout_triggers_degraded PASSED [ 30%]
tests/unit/test_bybit_ws_client.py::test_ws_queue_maxsize_overflow_policy PASSED [ 31%]
tests/unit/test_bybit_ws_client.py::test_testnet_wss_url_enforced PASSED [ 31%]
tests/unit/test_bybit_ws_client.py::test_missing_api_key_prevents_ws_start PASSED [ 31%]
tests/unit/test_docs_ssot_paths.py::test_task_plan_has_no_deprecated_oracle_path PASSED [ 32%]
tests/unit/test_docs_ssot_paths.py::test_task_plan_has_correct_oracle_path PASSED [ 32%]
tests/unit/test_docs_ssot_paths.py::test_oracle_file_exists PASSED       [ 32%]
tests/unit/test_docs_ssot_paths.py::test_deprecated_oracle_file_does_not_exist PASSED [ 33%]
tests/unit/test_docs_ssot_paths.py::test_transition_py_references_flow_md PASSED [ 33%]
tests/unit/test_emergency.py::test_price_drop_1m_exceeds_threshold_enters_cooldown PASSED [ 33%]
tests/unit/test_emergency.py::test_price_drop_5m_exceeds_threshold_enters_cooldown PASSED [ 34%]
tests/unit/test_emergency.py::test_price_drop_both_below_threshold_no_action PASSED [ 34%]
tests/unit/test_emergency.py::test_balance_anomaly_zero_equity_halts PASSED [ 34%]
tests/unit/test_emergency.py::test_balance_anomaly_stale_timestamp_halts PASSED [ 35%]
tests/unit/test_emergency.py::test_latency_exceeds_5s_sets_emergency_block PASSED [ 35%]
tests/unit/test_emergency.py::test_auto_recovery_after_5_consecutive_minutes PASSED [ 35%]
tests/unit/test_emergency.py::test_auto_recovery_sets_30min_cooldown PASSED [ 35%]
tests/unit/test_entry_allowed.py::test_gate_halt_rejects PASSED          [ 36%]
tests/unit/test_entry_allowed.py::test_gate_cooldown_rejects_before_timeout PASSED [ 36%]
tests/unit/test_entry_allowed.py::test_gate_cooldown_allows_after_timeout PASSED [ 36%]
tests/unit/test_entry_allowed.py::test_gate_max_trades_per_day_rejects PASSED [ 37%]
tests/unit/test_entry_allowed.py::test_gate_atr_min_rejects PASSED       [ 37%]
tests/unit/test_entry_allowed.py::test_gate_ev_gate_rejects PASSED       [ 37%]
tests/unit/test_entry_allowed.py::test_gate_maker_only_enforced PASSED   [ 38%]
tests/unit/test_entry_allowed.py::test_gate_one_way_mode_validates PASSED [ 38%]
tests/unit/test_entry_allowed.py::test_all_gates_pass_allows PASSED      [ 38%]
tests/unit/test_event_handler.py::test_handle_fill_event_entry_pending_to_in_position PASSED [ 39%]
tests/unit/test_event_handler.py::test_handle_partial_fill_stop_immediately_placed PASSED [ 39%]
tests/unit/test_event_handler.py::test_handle_cancel_with_filled_qty_becomes_in_position PASSED [ 39%]
tests/unit/test_event_handler.py::test_handle_cancel_with_zero_filled_becomes_flat PASSED [ 40%]
tests/unit/test_event_handler.py::test_handle_reject_returns_to_flat PASSED [ 40%]
tests/unit/test_event_handler.py::test_execute_intents_stop_amend PASSED [ 40%]
tests/unit/test_event_handler.py::test_execute_intents_halt_cancels_all_orders PASSED [ 40%]
tests/unit/test_event_router.py::TestEventRouterGate3::test_event_router_delegates_to_transition PASSED [ 41%]
tests/unit/test_event_router.py::TestEventRouterGate3::test_event_router_emergency_event_delegation PASSED [ 41%]
tests/unit/test_exit_manager.py::test_stop_hit_long PASSED               [ 41%]
tests/unit/test_exit_manager.py::test_stop_hit_short PASSED              [ 42%]
tests/unit/test_exit_manager.py::test_stop_not_hit_long PASSED           [ 42%]
tests/unit/test_exit_manager.py::test_stop_not_hit_short PASSED          [ 42%]
tests/unit/test_exit_manager.py::test_create_exit_intent PASSED          [ 43%]
tests/unit/test_exit_manager.py::test_stop_hit_long_boundary PASSED      [ 43%]
tests/unit/test_exit_manager.py::test_stop_hit_short_boundary PASSED     [ 43%]
tests/unit/test_exit_manager.py::test_stop_hit_no_stop_price PASSED      [ 44%]
tests/unit/test_fee_verification.py::test_estimate_fee_usd_inverse_formula PASSED [ 44%]
tests/unit/test_fee_verification.py::test_verify_fee_post_trade_no_spike PASSED [ 44%]
tests/unit/test_fee_verification.py::test_verify_fee_post_trade_spike_detected PASSED [ 45%]
tests/unit/test_fee_verification.py::test_apply_fee_spike_tightening_increases_ev_multiplier PASSED [ 45%]
tests/unit/test_fee_verification.py::test_apply_fee_spike_tightening_no_change_when_inactive PASSED [ 45%]
tests/unit/test_flow_minimum_contract.py::test_tick_engine_module_exists PASSED [ 45%]
tests/unit/test_flow_minimum_contract.py::test_emergency_gate_module_exists PASSED [ 46%]
tests/unit/test_flow_minimum_contract.py::test_emergency_evaluated_before_transition PASSED [ 46%]
tests/unit/test_flow_minimum_contract.py::test_tick_engine_file_has_flow_reference PASSED [ 46%]
tests/unit/test_flow_minimum_contract.py::test_emergency_gate_file_has_flow_reference PASSED [ 47%]
tests/unit/test_halt_logger.py::test_log_halt_includes_required_fields PASSED [ 47%]
tests/unit/test_halt_logger.py::test_log_halt_includes_context_snapshot PASSED [ 47%]
tests/unit/test_halt_logger.py::test_validate_halt_schema_rejects_missing_required_field PASSED [ 48%]
tests/unit/test_halt_logger.py::test_log_halt_includes_emergency_trigger_type PASSED [ 48%]
tests/unit/test_ids.py::test_generate_signal_id_deterministic PASSED     [ 48%]
tests/unit/test_ids.py::test_generate_signal_id_length_under_36 PASSED   [ 49%]
tests/unit/test_ids.py::test_validate_order_link_id_valid PASSED         [ 49%]
tests/unit/test_ids.py::test_validate_order_link_id_too_long PASSED      [ 49%]
tests/unit/test_ids.py::test_validate_order_link_id_invalid_chars PASSED [ 50%]
tests/unit/test_ids.py::test_sha1_hash_collision_resistance PASSED       [ 50%]
tests/unit/test_liquidation_gate.py::test_calculate_liquidation_distance_long PASSED [ 50%]
tests/unit/test_liquidation_gate.py::test_calculate_liquidation_distance_short PASSED [ 50%]
tests/unit/test_liquidation_gate.py::test_gate_rejects_too_close PASSED  [ 51%]
tests/unit/test_liquidation_gate.py::test_gate_passes_sufficient_distance PASSED [ 51%]
tests/unit/test_liquidation_gate.py::test_dynamic_criteria_stage1 PASSED [ 51%]
tests/unit/test_liquidation_gate.py::test_dynamic_criteria_stage3 PASSED [ 52%]
tests/unit/test_liquidation_gate.py::test_fallback_api_failure_high_leverage PASSED [ 52%]
tests/unit/test_liquidation_gate.py::test_fallback_api_failure_large_stop PASSED [ 52%]
tests/unit/test_log_storage.py::test_log_storage_append_basic PASSED     [ 53%]
tests/unit/test_log_storage.py::test_log_storage_partial_line_recovery PASSED [ 53%]
tests/unit/test_log_storage.py::test_log_storage_fsync_policy_batch PASSED [ 53%]
tests/unit/test_log_storage.py::test_log_storage_fsync_policy_critical_event PASSED [ 54%]
tests/unit/test_log_storage.py::test_log_storage_rotation_boundary_no_line_loss PASSED [ 54%]
tests/unit/test_log_storage.py::test_log_storage_single_syscall_write PASSED [ 54%]
tests/unit/test_log_storage.py::test_log_storage_read_specific_date PASSED [ 55%]
tests/unit/test_log_storage.py::test_log_storage_pre_rotate_flush_and_fsync PASSED [ 55%]
tests/unit/test_market_regime.py::TestMarketRegimeMASlope::test_calculate_ma_slope_uptrend PASSED [ 55%]
tests/unit/test_market_regime.py::TestMarketRegimeMASlope::test_calculate_ma_slope_downtrend PASSED [ 55%]
tests/unit/test_market_regime.py::TestMarketRegimeMASlope::test_calculate_ma_slope_flat PASSED [ 56%]
tests/unit/test_market_regime.py::TestMarketRegimeClassification::test_classify_regime_trending_up PASSED [ 56%]
tests/unit/test_market_regime.py::TestMarketRegimeClassification::test_classify_regime_trending_down PASSED [ 56%]
tests/unit/test_market_regime.py::TestMarketRegimeClassification::test_classify_regime_ranging PASSED [ 57%]
tests/unit/test_market_regime.py::TestMarketRegimeClassification::test_classify_regime_high_vol PASSED [ 57%]
tests/unit/test_market_regime.py::TestMarketRegimeClassification::test_classify_regime_boundary PASSED [ 57%]
tests/unit/test_metrics_logger.py::test_log_metrics_update_includes_required_fields PASSED [ 58%]
tests/unit/test_metrics_logger.py::test_log_metrics_update_tracks_performance_over_time PASSED [ 58%]
tests/unit/test_metrics_logger.py::test_validate_metrics_schema_rejects_missing_required_field PASSED [ 58%]
tests/unit/test_metrics_logger.py::test_log_metrics_update_includes_num_closed_trades PASSED [ 59%]
tests/unit/test_metrics_tracker.py::test_calculate_winrate_rolling_window PASSED [ 59%]
tests/unit/test_metrics_tracker.py::test_update_metrics_on_closed_trade_win PASSED [ 59%]
tests/unit/test_metrics_tracker.py::test_update_metrics_on_closed_trade_loss PASSED [ 60%]
tests/unit/test_metrics_tracker.py::test_loss_streak_reduces_size_multiplier PASSED [ 60%]
tests/unit/test_metrics_tracker.py::test_win_streak_recovers_size_multiplier PASSED [ 60%]
tests/unit/test_metrics_tracker.py::test_winrate_gate_enforcement PASSED [ 60%]
tests/unit/test_orchestrator_entry_flow.py::test_entry_flow_success PASSED [ 61%]
tests/unit/test_orchestrator_entry_flow.py::test_entry_blocked_state_not_flat PASSED [ 61%]
tests/unit/test_orchestrator_entry_flow.py::test_entry_blocked_degraded_mode PASSED [ 61%]
tests/unit/test_orchestrator_entry_flow.py::test_entry_blocked_no_signal PASSED [ 62%]
tests/unit/test_orchestrator_entry_flow.py::test_entry_blocked_gate_reject PASSED [ 62%]
tests/unit/test_orchestrator_entry_flow.py::test_entry_blocked_sizing_fail PASSED [ 62%]
tests/unit/test_orchestrator_entry_flow.py::test_entry_blocked_rest_client_unavailable PASSED [ 63%]
tests/unit/test_orchestrator_event_processing.py::test_event_processing_entry_fill_success PASSED [ 63%]
tests/unit/test_orchestrator_event_processing.py::test_event_processing_exit_fill_success PASSED [ 63%]
tests/unit/test_orchestrator_event_processing.py::test_event_processing_no_pending_order PASSED [ 64%]
tests/unit/test_orchestrator_event_processing.py::test_event_processing_order_id_mismatch PASSED [ 64%]
tests/unit/test_orchestrator_event_processing.py::test_event_processing_dual_id_matching_order_id PASSED [ 64%]
tests/unit/test_orchestrator_event_processing.py::test_event_processing_dual_id_matching_order_link_id PASSED [ 65%]
tests/unit/test_orchestrator_event_processing.py::test_state_consistency_check_position_without_state PASSED [ 65%]
tests/unit/test_orchestrator_event_processing.py::test_state_consistency_check_state_without_position PASSED [ 65%]
tests/unit/test_orchestrator_event_processing.py::test_state_consistency_check_normal PASSED [ 65%]
tests/unit/test_order_executor.py::test_place_entry_order_success PASSED [ 66%]
tests/unit/test_order_executor.py::test_place_entry_order_idempotency PASSED [ 66%]
tests/unit/test_order_executor.py::test_place_entry_order_validates_order_link_id_length PASSED [ 66%]
tests/unit/test_order_executor.py::test_place_stop_loss_conditional_order_params PASSED [ 67%]
tests/unit/test_order_executor.py::test_place_stop_loss_direction_short PASSED [ 67%]
tests/unit/test_order_executor.py::test_amend_stop_loss_success PASSED   [ 67%]
tests/unit/test_order_executor.py::test_amend_stop_loss_not_supported_fallback PASSED [ 68%]
tests/unit/test_order_executor.py::test_cancel_order_by_order_link_id PASSED [ 68%]
tests/unit/test_readme_links_exist.py::test_readme_markdown_links_all_exist PASSED [ 68%]
tests/unit/test_readme_links_exist.py::test_readme_references_ssot_documents PASSED [ 69%]
tests/unit/test_session_risk.py::test_daily_loss_cap_not_exceeded PASSED [ 69%]
tests/unit/test_session_risk.py::test_daily_loss_cap_exceeded PASSED     [ 69%]
tests/unit/test_session_risk.py::test_daily_loss_cap_reset_at_boundary PASSED [ 70%]
tests/unit/test_session_risk.py::test_daily_loss_cap_utc_23_59_59_edge_case PASSED [ 70%]
tests/unit/test_session_risk.py::test_daily_loss_cap_utc_00_00_01_edge_case PASSED [ 70%]
tests/unit/test_session_risk.py::test_weekly_loss_cap_not_exceeded PASSED [ 70%]
tests/unit/test_session_risk.py::test_weekly_loss_cap_exceeded PASSED    [ 71%]
tests/unit/test_session_risk.py::test_weekly_loss_cap_reset_at_boundary PASSED [ 71%]
tests/unit/test_session_risk.py::test_loss_streak_2 PASSED               [ 71%]
tests/unit/test_session_risk.py::test_loss_streak_3_halt PASSED          [ 72%]
tests/unit/test_session_risk.py::test_loss_streak_5_cooldown PASSED      [ 72%]
tests/unit/test_session_risk.py::test_fee_spike_single PASSED            [ 72%]
tests/unit/test_session_risk.py::test_fee_spike_consecutive_halt PASSED  [ 73%]
tests/unit/test_session_risk.py::test_fee_spike_non_consecutive PASSED   [ 73%]
tests/unit/test_session_risk.py::test_slippage_spike_2_times PASSED      [ 73%]
tests/unit/test_session_risk.py::test_slippage_spike_3_times_halt PASSED [ 74%]
tests/unit/test_session_risk.py::test_slippage_spike_window_expired PASSED [ 74%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerDailyPnL::test_track_daily_pnl_simple PASSED [ 74%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerDailyPnL::test_track_daily_pnl_utc_boundary PASSED [ 75%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerDailyPnL::test_track_daily_pnl_empty PASSED [ 75%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerWeeklyPnL::test_track_weekly_pnl_simple PASSED [ 75%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerWeeklyPnL::test_track_weekly_pnl_week_rollover PASSED [ 75%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerLossStreak::test_calculate_loss_streak_simple PASSED [ 76%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerLossStreak::test_calculate_loss_streak_with_win PASSED [ 76%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerLossStreak::test_calculate_loss_streak_zero_pnl PASSED [ 76%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerLossStreak::test_calculate_loss_streak_empty PASSED [ 77%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerFeeRatio::test_track_fee_ratio_simple PASSED [ 77%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerFeeRatio::test_track_fee_ratio_empty PASSED [ 77%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerSlippage::test_track_slippage_simple PASSED [ 78%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerSlippage::test_track_slippage_within_window PASSED [ 78%]
tests/unit/test_session_risk_tracker.py::TestSessionRiskTrackerSlippage::test_track_slippage_empty PASSED [ 78%]
tests/unit/test_signal_generator.py::test_grid_up_generates_sell_signal PASSED [ 79%]
tests/unit/test_signal_generator.py::test_grid_down_generates_buy_signal PASSED [ 79%]
tests/unit/test_signal_generator.py::test_no_signal_within_grid_range PASSED [ 79%]
tests/unit/test_signal_generator.py::test_calculate_grid_spacing_from_atr PASSED [ 80%]
tests/unit/test_signal_generator.py::test_calculate_grid_spacing_with_custom_multiplier PASSED [ 80%]
tests/unit/test_signal_generator.py::test_grid_boundary_exact_buy PASSED [ 80%]
tests/unit/test_signal_generator.py::test_grid_boundary_exact_sell PASSED [ 80%]
tests/unit/test_signal_generator.py::test_signal_contains_qty PASSED     [ 81%]
tests/unit/test_signal_generator.py::test_initial_entry_signal_when_no_last_fill PASSED [ 81%]
tests/unit/test_signal_generator.py::test_multiple_grid_levels_away PASSED [ 81%]
tests/unit/test_sizing.py::test_contracts_from_loss_budget PASSED        [ 82%]
tests/unit/test_sizing.py::test_margin_feasibility_constrains_contracts PASSED [ 82%]
tests/unit/test_sizing.py::test_tick_lot_size_correction PASSED          [ 82%]
tests/unit/test_sizing.py::test_min_contracts_validation PASSED          [ 83%]
tests/unit/test_sizing.py::test_margin_vs_loss_budget_minimum PASSED     [ 83%]
tests/unit/test_sizing.py::test_fee_buffer_included_in_margin_check PASSED [ 83%]
tests/unit/test_sizing.py::test_tick_lot_size_revalidation_after_rounding PASSED [ 84%]
tests/unit/test_sizing.py::test_contract_size_conversion PASSED          [ 84%]
tests/unit/test_state_transition.py::TestEntryPendingTransitions::test_entry_pending_fill_transitions_to_in_position PASSED [ 84%]
tests/unit/test_state_transition.py::TestEntryPendingTransitions::test_entry_pending_partial_fill_transitions_to_in_position_with_entry_working PASSED [ 85%]
tests/unit/test_state_transition.py::TestEntryPendingTransitions::test_entry_pending_reject_transitions_to_flat PASSED [ 85%]
tests/unit/test_state_transition.py::TestEntryPendingTransitions::test_entry_pending_cancel_zero_fill_transitions_to_flat PASSED [ 85%]
tests/unit/test_state_transition.py::TestEntryPendingTransitions::test_entry_pending_cancel_partial_fill_transitions_to_in_position PASSED [ 85%]
tests/unit/test_state_transition.py::TestExitPendingTransitions::test_exit_pending_fill_transitions_to_flat PASSED [ 86%]
tests/unit/test_state_transition.py::TestExitPendingTransitions::test_exit_pending_reject_stays_in_exit_pending PASSED [ 86%]
tests/unit/test_state_transition.py::TestExitPendingTransitions::test_exit_pending_cancel_stays_in_exit_pending PASSED [ 86%]
tests/unit/test_state_transition.py::TestExitPendingPartialFills::test_exit_pending_partial_fill_reduces_position_qty_and_stays_exit_pending PASSED [ 87%]
tests/unit/test_state_transition.py::TestExitPendingPartialFills::test_exit_pending_fill_after_partial_should_flat PASSED [ 87%]
tests/unit/test_state_transition.py::TestExitPendingPartialFills::test_exit_pending_overfill_should_halt PASSED [ 87%]
tests/unit/test_state_transition.py::TestUnexpectedEvents::test_flat_unexpected_fill_should_halt PASSED [ 88%]
tests/unit/test_state_transition.py::TestEmergencyEvents::test_liquidation_from_in_position_should_halt PASSED [ 88%]
tests/unit/test_state_transition.py::TestEmergencyEvents::test_liquidation_from_flat_should_halt PASSED [ 88%]
tests/unit/test_state_transition.py::TestInPositionAdditionalFills::test_in_position_additional_partial_fill_increases_qty_and_amends_stop PASSED [ 89%]
tests/unit/test_state_transition.py::TestInPositionAdditionalFills::test_in_position_entry_fill_complete_sets_entry_working_false PASSED [ 89%]
tests/unit/test_state_transition.py::TestEntryBlocking::test_halt_blocks_new_entry PASSED [ 89%]
tests/unit/test_state_transition.py::TestEntryBlocking::test_cooldown_blocks_new_entry PASSED [ 90%]
tests/unit/test_state_transition.py::TestEntryBlocking::test_flat_allows_entry PASSED [ 90%]
tests/unit/test_state_transition.py::TestEntryBlocking::test_other_states_allow_entry PASSED [ 90%]
tests/unit/test_state_transition.py::TestEntryBlocking::test_halt_state_persists_on_unexpected_events PASSED [ 90%]
tests/unit/test_stop_manager.py::test_should_update_stop_below_threshold_no_update PASSED [ 91%]
tests/unit/test_stop_manager.py::test_should_update_stop_at_threshold_triggers_update PASSED [ 91%]
tests/unit/test_stop_manager.py::test_should_update_stop_debounce_blocks_update PASSED [ 91%]
tests/unit/test_stop_manager.py::test_should_update_stop_debounce_passed_allows_update PASSED [ 92%]
tests/unit/test_stop_manager.py::test_determine_stop_action_amend_priority PASSED [ 92%]
tests/unit/test_stop_manager.py::test_determine_stop_action_retry_amend_after_reject PASSED [ 92%]
tests/unit/test_stop_manager.py::test_determine_stop_action_cancel_place_after_retry_limit PASSED [ 93%]
tests/unit/test_stop_manager.py::test_determine_stop_action_missing_stop_requires_place PASSED [ 93%]
tests/unit/test_stop_manager.py::test_recover_missing_stop_emits_place_intent PASSED [ 93%]
tests/unit/test_stop_manager.py::test_entry_working_blocks_stop_update PASSED [ 94%]
tests/unit/test_trade_logger.py::test_log_trade_entry_includes_required_fields PASSED [ 94%]
tests/unit/test_trade_logger.py::test_log_trade_exit_includes_pnl_and_fee PASSED [ 94%]
tests/unit/test_trade_logger.py::test_validate_trade_schema_rejects_missing_required_field PASSED [ 95%]
tests/unit/test_trade_logger.py::test_log_trade_includes_policy_version_for_reproducibility PASSED [ 95%]
tests/unit/test_trade_logger.py::test_log_trade_includes_stage_and_gate_results PASSED [ 95%]
tests/unit/test_trade_logger_v1.py::test_trade_log_v1_contains_all_execution_quality_fields PASSED [ 95%]
tests/unit/test_trade_logger_v1.py::test_trade_log_v1_market_regime_required PASSED [ 96%]
tests/unit/test_trade_logger_v1.py::test_trade_log_v1_schema_version_required PASSED [ 96%]
tests/unit/test_trade_logger_v1.py::test_trade_log_v1_config_hash_required PASSED [ 96%]
tests/unit/test_trade_logger_v1.py::test_trade_log_v1_git_commit_required PASSED [ 97%]
tests/unit/test_trade_logger_v1.py::test_market_regime_deterministic_calculation PASSED [ 97%]
tests/unit/test_trade_logger_v1.py::test_trade_log_v1_invalid_market_regime_fails PASSED [ 97%]
tests/unit/test_trade_logger_v1.py::test_trade_log_v1_exchange_server_time_offset_required PASSED [ 98%]
tests/unit/test_trade_logger_v1.py::test_trade_log_v1_full_validation_pass PASSED [ 98%]
tests/unit/test_ws_health.py::test_heartbeat_timeout_10s_enters_degraded PASSED [ 98%]
tests/unit/test_ws_health.py::test_event_drop_count_3_enters_degraded PASSED [ 99%]
tests/unit/test_ws_health.py::test_degraded_duration_60s_returns_halt PASSED [ 99%]
tests/unit/test_ws_health.py::test_ws_recovery_exits_degraded PASSED     [ 99%]
tests/unit/test_ws_health.py::test_ws_recovery_sets_5min_cooldown PASSED [100%]

====================== 320 passed, 15 deselected in 0.46s ======================
